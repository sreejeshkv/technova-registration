<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Technova 2.0: Event-day Registration</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 420px;
      margin: auto;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      background: #1a73e8;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    button:disabled {
      background: #9aa0a6;
    }

    .loading {
      margin-top: 20px;
      text-align: center;
      font-weight: bold;
    }

    .spinner {
      margin: 0 auto 10px;
      width: 32px;
      height: 32px;
      border: 4px solid #ddd;
      border-top: 4px solid #1a73e8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: #f1f3f4;
      border-radius: 6px;
      text-align: center;
    }

    .regn {
      font-size: 26px;
      font-weight: bold;
      margin-top: 10px;
    }

    .error {
      color: red;
      font-weight: bold;
      margin-top: 15px;
      text-align: center;
    }
  </style>
</head>

<body>

<h2>Technova 2.0: Event-day Registration</h2>
<div id="todayDate" style="text-align:center; font-weight:bold; margin-bottom:15px;"></div>

<form id="form">

  <!-- Instruction -->
  <div style="text-align:center; font-weight:bold; margin-bottom:10px;">
    Select your student type to continue
  </div>

  <!-- Student Type -->
  <select id="participantType" required>
    <option value="">Select Student Type</option>
    <option value="school">School / Higher Secondary</option>
    <option value="college">College / Diploma</option>
  </select>

  <!-- Hidden until type selected -->
  <div id="detailsSection" style="display:none;">

    <input name="name" placeholder="Name of Student" required>

    <input
      name="mobile"
      placeholder="Mobile Number"
      pattern="[0-9]{10}"
      inputmode="numeric"
      title="Enter a valid 10-digit mobile number"
      required
    >

    <input name="email" type="email" placeholder="Email ID" required>

    <!-- Class / Year -->
    <div id="classYearWrapper"></div>

    <!-- Course -->
    <div id="courseWrapper" style="display:none;">
      <input name="course" id="courseInput" placeholder="Course Name">
    </div>

    <!-- College / School -->
    <input
      name="college"
      id="collegeInput"
      placeholder="College / School Name"
      required
    >

    <!-- Event -->
    <select name="event" id="eventSelect" required>
      <option value="">Select Event</option>
    </select>

    <button id="submitBtn" type="submit">Generate Registration ID</button>

  </div>
</form>

<div id="loading" class="loading" style="display:none;">
  <div class="spinner"></div>
  Generating Registration ID…
</div>

<div id="output" class="result" style="display:none;"></div>
<div id="error" class="error" style="display:none;"></div>

<script>
  /* ========= CONFIG ========= */
  const EVENT_DAY = 2; // CHANGE TO 2 ON DAY 2

  const SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbzq1F5Smb-XAtLPj8dF-iO0zcETudZ51zgW_k9TxIb8D-US008KFgN-OaTj7Wzf2Am5yg/exec";

  const EVENTS = [
    // Day 1
  //  { name: "PRAYOGA, The Project Demo Contest", type: "college", day: 1 },
   // { name: "BossBattle, The Best Manager Contest", type: "college", day: 1 },
 //   { name: "IDEATHON, Startup Idea Presentation Contest", type: "college", day: 1 },
   // { name: "Sci-WIZ, Science Quiz for School students", type: "school", day: 1 },
   // { name: "Tech-Snap, Short Time Tech Talk for School students", type: "school", day: 1 },

    // Day 2
    { name: "Robo WAR, A Robot Demo Contest", type: "college", day: 2 },
//    { name: "CodeCLASH, C Coding Contest", type: "college", day: 2 },
    { name: "ElectroX, A Circuit Making Contest", type: "college", day: 2 },
    { name: "PRESENTA, The Seminar Contest", type: "college", day: 2 },
    { name: "PRESSCom, Press Conference Imitation Contest", type: "college", day: 2 },
    { name: "CrackIT, Find a Hidden Key inside a Code", type: "college", day: 2 },
    { name: "BioQUEST, Test your Health Wisdom", type: "college", day: 2 },
    { name: "TATVA, The Quiz Contest", type: "college", day: 2 },
    { name: "TechnoBOTS, A Robotic Contest for School students", type: "school", day: 2 }
  ];
  /* ========================== */

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("todayDate").textContent =
      "Date: " + new Date().toLocaleDateString("en-IN", {
        day: "numeric",
        month: "long",
        year: "numeric"
      });
  });

  const participantType = document.getElementById("participantType");
  const detailsSection = document.getElementById("detailsSection");
  const classYearWrapper = document.getElementById("classYearWrapper");
  const courseWrapper = document.getElementById("courseWrapper");
  const collegeInput = document.getElementById("collegeInput");
  const eventSelect = document.getElementById("eventSelect");

  participantType.addEventListener("change", () => {
    const type = participantType.value;
    const form = document.getElementById("form");

    // Reset everything except student type
    form.reset();
    participantType.value = type;

    detailsSection.style.display = "none";
    classYearWrapper.innerHTML = "";
    courseWrapper.style.display = "none";
    eventSelect.innerHTML = '<option value="">Select Event</option>';

    if (!type) return;

    detailsSection.style.display = "block";

    if (type === "school") {
      classYearWrapper.innerHTML =
        '<input name="classYear" placeholder="Class" required>';
      collegeInput.placeholder = "School Name";
    }

    if (type === "college") {
      classYearWrapper.innerHTML =
        '<select name="classYear" required>' +
        '<option value="">Select Year of Study</option>' +
        '<option value="1st Year">1st Year</option>' +
        '<option value="2nd Year">2nd Year</option>' +
        '<option value="3rd Year">3rd Year</option>' +
        '<option value="4th Year">4th Year</option>' +
        '</select>';
      courseWrapper.style.display = "block";
      collegeInput.placeholder = "College Name";
    }

    EVENTS.forEach(ev => {
      if (ev.type === type && ev.day === EVENT_DAY) {
        const opt = document.createElement("option");
        opt.value = ev.name;
        opt.textContent = ev.name.replace(/-/g, " – ");
        eventSelect.appendChild(opt);
      }
    });
  });

  // Clear cached form on back navigation
  window.addEventListener("pageshow", e => {
    if (e.persisted) {
      const form = document.getElementById("form");
      form.reset();
      participantType.value = "";
      detailsSection.style.display = "none";
    }
  });

  const form = document.getElementById("form");
  const loading = document.getElementById("loading");
  const output = document.getElementById("output");
  const errorBox = document.getElementById("error");
  const submitBtn = document.getElementById("submitBtn");

  form.onsubmit = async e => {
    e.preventDefault();

    errorBox.style.display = "none";
    form.style.display = "none";
    loading.style.display = "block";
    submitBtn.disabled = true;

    const params = new URLSearchParams(
      Object.fromEntries(new FormData(form).entries())
    );

    try {
      const res = await fetch(SCRIPT_URL, { method: "POST", body: params });
      const out = await res.json();

      loading.style.display = "none";
      output.style.display = "block";

      output.innerHTML =
        "<div><strong>" + out.name + "</strong></div>" +
        "<div>" + out.event + "</div>" +
        "<div class='regn'>" + out.regnId + "</div>" +
        "<div>Please show this Registration ID at the desk.</div>";

    } catch {
      loading.style.display = "none";
      form.style.display = "block";
      submitBtn.disabled = false;
      errorBox.textContent =
        "Something went wrong. Please contact the registration desk.";
      errorBox.style.display = "block";
    }
  };

  window.addEventListener("load", () => {
  const form = document.getElementById("form");
  form.reset();

  document.getElementById("participantType").value = "";
  document.getElementById("detailsSection").style.display = "none";
});

</script>

</body>
</html>
